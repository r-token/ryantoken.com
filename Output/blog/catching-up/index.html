<!DOCTYPE html><html lang="en"><head><meta charset="UTF-8"/><meta name="og:site_name" content="Ryan Token"/><link rel="canonical" href="https://ryantoken.com/blog/catching-up"/><meta name="twitter:url" content="https://ryantoken.com/blog/catching-up"/><meta name="og:url" content="https://ryantoken.com/blog/catching-up"/><title>Catching Up | Ryan Token</title><meta name="twitter:title" content="Catching Up | Ryan Token"/><meta name="og:title" content="Catching Up | Ryan Token"/><meta name="description" content="Modernizing CatchUp, my first iOS app, with SwiftUI, Core Data, and cleaner code."/><meta name="twitter:description" content="Modernizing CatchUp, my first iOS app, with SwiftUI, Core Data, and cleaner code."/><meta name="og:description" content="Modernizing CatchUp, my first iOS app, with SwiftUI, Core Data, and cleaner code."/><meta name="twitter:card" content="summary"/><link rel="stylesheet" href="/styles.css" type="text/css"/><meta name="viewport" content="width=device-width, initial-scale=1.0"/><link rel="shortcut icon" href="/images/favicon.png" type="image/png"/><link rel="alternate" href="/feed.rss" type="application/rss+xml" title="Subscribe to Ryan Token"/><meta name="twitter:image" content="https://ryantoken.com/Resources/favicons/favicon.ico"/><meta name="og:image" content="https://ryantoken.com/Resources/favicons/favicon.ico"/></head><body class="item-page"><header><div class="wrapper"><a class="site-name" href="/">Ryan Token</a><nav><ul><li><a href="/blog">Blog</a></li><li><a href="/about">About</a></li><li><a href="/projects">Projects</a></li><li><a href="/meta">Meta</a></li></ul></nav></div></header><div class="wrapper"><article><div class="content"><h1>Catching Up</h1><p>May 08, 2020</p><p><em>Modernizing CatchUp, my first iOS app, with SwiftUI, Core Data, and cleaner code.</em></p><br /><hr><br /><p>CatchUp - Keep in Touch was first released on May 6, 2018. It was the first iOS app I'd ever published to the App Store. Almost exactly two years later, I'm publishing this blog post and releasing an all-new, completely rewritten version of CatchUp.</p><p>This post talks about the origins of CatchUp, deciding to start over from scratch, implementing SwiftUI and Core Data, and writing cleaner code. I also compare the new version to the previous version at the end of the post.</p><br /><h2>Getting Started with iOS</h2><p>I graduated from college in 2017 and was primarily familiar with web development at that point. I had never taken a mobile development course in school and knew nothing about Objective-C or Swift. For whatever reason, iOS/mobile development hadn't truly crossed my mind until after graduation. But I'll tell you what, once I started down that path in late 2017 I never turned back.</p><p>I spent the next several months learning the basics of Swift, UIKit, and everything else that comes along with iOS development. Most of that learning came via courses on <a href="https://www.udemy.com" target="_blank">Udemy</a>, tutorials from <a href="https://www.hackingwithswift.com" target="_blank">Hacking with Swift</a> and <a href="https://www.swiftbysundell.com" target="_blank">Swift by Sundell</a>, finding answers on <a href="https://stackoverflow.com" target="_blank">Stack Overflow</a>, and stumbling around in the dark by myself until I happened upon a solution.</p><p>When all was said and done, I had an app, and it worked! Much like <a href="https://ryantoken.com/blog/rebuilding-my-website" target="_blank">version one of my website</a>, it wasn't the greatest app in the world, but it was my app, and I was proud to have built it.</p><p>I put it out on the App Store on May 6, 2018, and, to my surprise, it did reasonably well. I even got some publicity out of it in the form of a feature in Brett Terpstra's <a href="http://esn.fm/systematic/218" target="_blank">Systematic</a> podcast around the 46:00 minute mark of episode 218.</p><p>However, over the following months/years, CatchUp began to suffer from some poor original choices made in the app.</p><br /><h2>A Lull in Development</h2><p>For the first few months after release in 2018, I updated CatchUp semi-regularly with new features and some minor design tweaks. However, as I began evaluating some larger-scope features I wanted to implement, I continued to run into the same problem.</p><p>Above all else, my existing code was just plain <em>bad</em>.</p><p>As I mentioned, I put this out pretty much immediately after I had learned the basics of Swift and iOS development. Knowing the basics != understanding how to make a proper application. My naming was poor, many functions were massive and had far too many interspersed responsibilities, there was no consistency in where components were located, I was practically trial-and-erroring my Storyboards, etc. The list could go on and truly envelop this entire post. I'll spare you that.</p><p>However, the app was simple and straightforward enough that nearly all of this went unnoticed by users. There was only one noticeable performance issue, and it didn't bother me enough at the time. As I said, the app was doing well! It was receiving nearly all 5-star reviews, it was featured on a podcast, what more could I ask for?</p><p>Lesson learned. Good reviews do not mean a high-quality application. As my plans for the app grew more ambitious, and as I learned more about proper development from my full-time job, the code atrocities I was committing became ever more glaring. As I continued to explore implementing significant new features, I consistently ran into walls caused by poor code quality.</p><p>About a year after release, I simply lost motivation for the app. I didn't want to put forth the necessary effort to fix the underlying problems with the code that were holding it back. And so in May of 2019, CatchUp was essentially left to die. And then came the email from Apple.</p><br /><h2>Starting Over</h2><p>In March 2020, Apple sent an email to all developers with a reminder that all apps for iPhone or iPad must be built with the iOS 13 SDK or later by June 30. If they weren't, they would no longer be available on the App Store.</p><p>CatchUp was my first iOS app, it holds a special place in my heart. But it was poorly written and had become increasingly difficult to maintain because of that.</p><p>This brought me to a crossroads of sorts. I saw three options in front of me.</p><p><strong>Option 1: Let it die.</strong></p><p>I honestly did consider this. Building the app with the iOS 13 SDK severely broke a significant amount of functionality within the app. Figuring this out would mean an even bigger maintenance hole to dig myself out of.</p><p><strong>Option 2: Bite the bullet and fix the app, but stick with the core technologies I began with.</strong></p><p>This probably would have taken less time than the option I ended up choosing, but would have been far less fun, and I would have learned significantly less.</p><p><strong>Option 3: Start from scratch and rewrite everything.</strong></p><p>Why not just blow away the whole project and start over?</p><p>A headlining announcement from WWDC 2019 was the debut of <a href="https://developer.apple.com/xcode/swiftui/" target="_blank">SwiftUI</a>. SwiftUI is a brand new framework from Apple which allows you to build user interfaces declaratively. Previously, all of iOS development was done using <a href="https://developer.apple.com/documentation/uikit" target="_blank">UIKit</a>. I watched the announcement happen live, and was instantly excited and drawn to it. I had considered rewriting parts of CatchUp with SwiftUI, but not the entire app.</p><p>Of course, I picked <strong>Option 3</strong>. SwiftUI marked the dawn of a new era in iOS development, and this was the perfect excuse for me to start a new project and learn how SwiftUI works.</p><p>This was also the perfect opportunity to address what ended up being one of the worst choices I made while building the original app: using <a href="https://developer.apple.com/documentation/foundation/userdefaults" target="_blank">UserDefaults</a> as my persistence/storage system instead of <a href="https://developer.apple.com/documentation/coredata" target="_blank">Core Data</a>.</p><p>Everything in v1.x of CatchUp used UserDefaults. I didn't choose UserDefaults because I thought that was the <em>right</em> way to do it, I chose UserDefaults simply because that's what I had learned from the Udemy course I took when first learning iOS development. I knew nothing about Core Data or how it worked at the time, and that has plagued CatchUp from the beginning. Until today.</p><p>So there was my path forward. A complete rebuild using SwiftUI instead of UIKit, and Core Data instead of UserDefaults. I was ecstatic about the idea, and CatchUp would get to live to see another day.</p><br /><h2>Implementing SwiftUI</h2><p>On the same day that SwiftUI was first announced back in 2019, I started taking Apple's (legitimately wonderful) <a href="https://developer.apple.com/tutorials/swiftui/tutorials" target="_blank">Learn to Make Apps with SwiftUI</a> tutorials. I also participated in Hacking with Swift's (also wonderful) <a href="https://www.hackingwithswift.com/100/swiftui" target="_blank">100 Days of SwiftUI</a> course and read <a href="https://www.hackingwithswift.com/quick-start/swiftui" target="_blank">SwiftUI by Example</a>. All of these things together gave me enough knowledge to feel comfortable with SwiftUI, even though documentation around it was/is not quite there.</p><p>In the case of Core Data, that has been around since 2005. There are <em>plenty</em> of resources out there to help you learn and understand how it works. SwiftUI was built to play nicely with Core Data, so after a few articles and WWDC videos from previous years, I felt good enough on that side too.</p><p>The rewrite started off moving at lightspeed. SwiftUI was <strong>amazing</strong>. Legitimately. I had a full mockup of all the major aspects of the user interface done in just a few hours, and they all looked better than before.</p><p>Of course, as expected and as I've heard from others who have used SwiftUI, once you get past the basics and move into an area where not much has been done yet, you find yourself in a strange and unknown world of mystery. Here are a couple of the strangest holes I found myself in.</p><p><strong>SwiftUI Issue #1:</strong></p><p>In CatchUp's 'Preference' screen, there are a few different pickers you might work with. I wanted to run some code every time that a picker was interacted with. Sounds simple enough, right? Using SwiftUI's onReceive modifier <em>does</em> work, but actually getting the value out the picker when onReceive is triggered is much weirder than you'd think.</p><p>You have to attach [self.<em>someSelection</em>].publisher.first() to the onReceive call, and then pass in the value from the picker via a closure. I can only hope that this is fixed in a subsequent SwiftUI update because it was maddeningly difficult to figure that out.</p><p>Here's the workaround I found on Stack Overflow - the fix is highlighted at the bottom of the picture:</p><style type="text/css">
.resizable-image img {
    text-align: center;
    margin: auto;
    width: 100%;
    border-radius: 5px;
}
</style><br /><div class="resizable-image">
    <img src="../../blog_images/catchingup-onReceive.png" alt="SwiftUI onReceive weirdness"/>
</div><br /><p><strong>SwiftUI Issue #2:</strong></p><p>At the time of writing, you need to manually pass Core Data's <a href="https://developer.apple.com/library/archive/documentation/DataManagement/Devpedia-CoreData/managedObjectContext.html#//apple_ref/doc/uid/TP40010398-CH24-SW1" target="_blank">managed object context</a> from one view to another if you want to be able to use that context in the view you're navigating to.</p><p>SwiftUI's @Environment property wrapper should theoretically allow the managed object context to be accessible from anywhere. You shouldn't need to manually pass it along from one view to another.</p><p>Unfortunately, this is a bug in the version of SwiftUI I built the app on. So I had to use the following workaround to pass in the managed object context when navigating from one view to another.</p><p>Here's what I found:</p><br /><div class="resizable-image">
    <img src="../../blog_images/catchingup-moc.png" alt="SwiftUI MOC weirdness"/>
</div><br /><p>There were several other small issues that I bumped into when building this out, but those two took me the longest to find solutions for. In general, though, this is what my browser typically looked like while in the throes of SwiftUI development.</p><br /><div class="resizable-image">
    <img src="../../blog_images/catchingup-somanytabs.png" alt="SwiftUI Browser Tabs"/>
</div><p><em>So. Many. SwiftUI. Tabs. (shoutout to Hacking with Swift and Swift by Sundell for solving most of my problems)</em></p><br /><p>There's also a <strong>third issue</strong> that still doesn't have a solution as of this post being published. Apple's Contacts frameworks don't work with SwiftUI at all.</p><p>This is the case with several frameworks since SwiftUI is still so new. However, for most frameworks that don't work natively with SwiftUI, you can simply create a bridge into UIKit. You'd render just those views using UIKit instead of SwiftUI, then come back to SwiftUI when you're done. The interplay between SwiftUI and UIKit was heavily advertised when SwiftUI was debuted in 2019.</p><p>Unfortunately, I've found the bridging between SwiftUI and UIKit for the contact picker to be especially buggy. This is not ideal. The contact picker - which shows up when you tap the 'Add Contacts' button on CatchUp's home screen - is likely the first button you'll ever tap in the app. I don't want a user's first experience with my app to feel buggy and show strange animation glitches.</p><p>I filed my first ever <a href="https://developer.apple.com/support/technical/" target="_blank">Technical Support Incident (TSI)</a> with Apple, and hope to have a resolution for that bug shortly.</p><p>I want to make something especially clear, though: Despite the somewhat bumpy road, I have <strong>loved</strong> working with SwiftUI. It has been a true joy and has significantly improved how I go about creating user interfaces. CatchUp V1 used Storyboards exclusively, and I would be more than OK with never having to create a Storyboard again. I know I could have done my layout programmatically with UIKit, but it's hard to imagine a system as clean and as nice as SwiftUI is proving to be.</p><br /><h2>Wrapping Up with Clean Code</h2><p>As I was putting the finishing touches on version 2.0 of CatchUp, I started reading <a href="https://www.amazon.com/Clean-Code-Handbook-Software-Craftsmanship/dp/0132350882" target="_blank">Clean Code</a> by "Uncle" Bob Martin.</p><p>I'll tell you what, dear reader, there could not have been a better time for me to read this book.</p><p>Since releasing the original app in 2018, I had learned a lot. I knew the SOLID principles, I understood the importance of proper naming and concise logic, but all of that truly sank in on a deeper level upon reading that book on my own.</p><p>While reading it, I found that nearly every chapter gave me some new idea on how to organize or clean up my code even further. It was a fantastic experience. I went from code, to book, to code, to book, and back and forth again and again until I had finished the book.</p><p>If you haven't read it, and you want to be a better programmer, I can't recommend it enough. Even being over a decade old at this point, I found it incredibly valuable.</p><p>Before reading it, CatchUp 2.0 was a massive improvement in underlying code quality simply from having gained more experience and a greater understanding of what "good" code is. After reading it, I am quite proud of the quality of code I've written. To be sure, there is more work to be done and more improvements to be made. But to have rewritten an entire app from scratch, leave all the cruft and bad ideas behind, and come out on the other end with what I have now is massively satisfying.</p><p>Here's a single point of reference for you: the difference in the number of total lines of code from version 1.1.2 to version 2.0.0, one update (and one year) later.</p><p>Lines of code is by no means a proper metric for overall code quality, but I think it represents how much simplification I was able to do for what is, by all accounts, an app that has <em>more</em> functionality than the previous version.</p><p><strong>Total lines of code for CatchUp version 1.1.2:</strong> 2,924</p><p><strong>Total lines of code for CatchUp version 2.0.0:</strong> 1,905</p><p><em>Lines of code counted with <a href="https://github.com/AlDanial/cloc" target="_blank">cloc</a></em></p><p>Over 1,000 fewer lines of code! For an app that is more advanced and has more functionality, I consider that a significant win.</p><br /><h2>What's Next</h2><p>With SwiftUI and cleaner code, CatchUp is ready for the new era of iOS development. I plan to write all of my personal apps in SwiftUI going forward unless there is something that makes it physically impossible to do so.</p><p>I'm proud of the product that's available out there now, and look forward to continuing to build on the modern foundation it has today.</p><p>CatchUp is completely free with no ads. Download the all-new CatchUp – Keep in Touch below:</p><br /><a href="https://itunes.apple.com/us/app/catchup-keep-in-touch/id1358023550" target="_blank" style="display:inline-block;overflow:hidden;background:url(https://linkmaker.itunes.apple.com/assets/shared/badges/en-us/appstore-lrg.svg) no-repeat;width:270px;height:80px;background-size:contain;"></a></div><span>Tagged with: </span><ul class="tag-list"><li><a href="/tags/ios">iOS</a></li><li><a href="/tags/swift">Swift</a></li><li><a href="/tags/swiftui">SwiftUI</a></li><li><a href="/tags/core-data">Core Data</a></li></ul></article></div><footer><p>Built with <a href="https://www.apple.com/swift/">Swift</a> – Generated using <a href="https://github.com/johnsundell/publish">Publish</a></p><p>View my <a href="/feed.rss">RSS feed</a> – Ryan Token 2020</p><br/></footer></body></html>